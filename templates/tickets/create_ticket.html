<!-- ============================= -->
<!-- CREATE TICKET PAGE -->
<!-- ============================= -->

<!DOCTYPE html>
<html>
<head>
    <title>Create Ticket</title>

    <style>
        body { font-family: Arial; background:#f4f6f9; padding:40px; }
        .container { background:white; padding:30px; border-radius:8px; max-width:600px; margin:auto; }
        label { font-weight:bold; }
        select, textarea { width:100%; padding:8px; margin-top:5px; }
        button { padding:10px 20px; background:#4CAF50; color:white; border:none; border-radius:5px; }
    </style>
</head>

<body>

<div class="container">

<h2>Create Ticket</h2>

<form method="POST">
    {% csrf_token %}

    <!-- ISSUE -->
    <label>Issue</label>
    <select name="issue" id="issue-dropdown">
        <option value="">Select Issue</option>
        {% for issue in issues %}
        <option value="{{ issue.id }}">{{ issue.name }}</option>
        {% endfor %}
    </select>

    <br><br>

    <!-- SUB ISSUE -->
    <label>Sub Issue</label>
    <select name="sub_issue" id="sub-issue-dropdown">
        <option value="">Select Sub Issue</option>
    </select>

    <br><br>

    <!-- DESCRIPTION -->
    <label>Description</label>
    <textarea name="description" rows="4"></textarea>

    <br><br>

    <button type="submit">Submit Ticket</button>

</form>

</div>

<!-- ============================= -->
<!-- AJAX SUB ISSUE DROPDOWN -->
<!-- ============================= -->
<script>
document.getElementById('issue-dropdown').addEventListener('change', function() {

    const issueId = this.value;

    fetch(`/tickets/get-sub-issues/?issue_id=${issueId}`)
        .then(response => response.json())
        .then(data => {

            let subDropdown = document.getElementById('sub-issue-dropdown');
            subDropdown.innerHTML = '<option value="">Select Sub Issue</option>';

            data.forEach(sub => {
                let option = document.createElement('option');
                option.value = sub.id;
                option.textContent = sub.name;
                subDropdown.appendChild(option);
            });
        });
});
</script>

</body>
</html>